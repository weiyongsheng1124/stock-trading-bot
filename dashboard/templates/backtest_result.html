<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‚¡ç¥¨äº¤æ˜“æ©Ÿå™¨äºº - å›æ¸¬çµæœ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- å°èˆªæ¬„ -->
    <nav class="bg-gray-800 text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="text-xl font-bold">ğŸ“ˆ è‚¡ç¥¨äº¤æ˜“æ©Ÿå™¨äºº</div>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/monitor" class="px-4 py-2 hover:text-gray-300">å³æ™‚ç›£æ§</a>
                    <a href="/backtest" class="bg-blue-600 px-4 py-2 rounded">å›æ¸¬</a>
                    <a href="/config" class="px-4 py-2 hover:text-gray-300">ç­–ç•¥é…ç½®</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- è¿”å›é€£çµ -->
        <div class="mb-4">
            <a href="/backtest" class="text-blue-600 hover:underline">â† é‡æ–°å›æ¸¬</a>
        </div>

        {% if error %}
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6">
            âŒ {{ error }}
        </div>
        {% else %}

        <!-- æ¨™é¡Œ -->
        <h1 class="text-3xl font-bold mb-2">{{ symbol }} å›æ¸¬çµæœ</h1>
        <p class="text-gray-600 mb-8">
            æœŸé–“ï¼š{{ period }} / {{ interval }} / åˆå§‹è³‡é‡‘ï¼š${{ "{:,}".format(capital) }}
        </p>

        <!-- çµ±è¨ˆå¡ç‰‡ -->
        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-8">
            <div class="bg-white rounded-lg shadow p-4">
                <div class="text-gray-500 text-xs">ç¸½å ±é…¬ç‡</div>
                <div class="text-2xl font-bold {% if result.total_return >= 0 %}text-green-600{% else %}text-red-600{% endif %}">
                    {{ "%.2f"|format(result.total_return) }}%
                </div>
            </div>
            <div class="bg-white rounded-lg shadow p-4">
                <div class="text-gray-500 text-xs">äº¤æ˜“æ¬¡æ•¸</div>
                <div class="text-2xl font-bold text-blue-600">{{ result.total_trades }}</div>
            </div>
            <div class="bg-white rounded-lg shadow p-4">
                <div class="text-gray-500 text-xs">å‹ç‡</div>
                <div class="text-2xl font-bold {% if result.win_rate >= 50 %}text-green-600{% else %}text-red-600{% endif %}">
                    {{ "%.1f"|format(result.win_rate) }}%
                </div>
                <div class="text-xs text-gray-400">{{ result.wins }} å‹ / {{ result.losses }} æ•—</div>
            </div>
            <div class="bg-white rounded-lg shadow p-4">
                <div class="text-gray-500 text-xs">æœ€å¤§å›æ’¤</div>
                <div class="text-2xl font-bold text-red-600">{{ "%.2f"|format(result.max_drawdown) }}%</div>
            </div>
            <div class="bg-white rounded-lg shadow p-4">
                <div class="text-gray-500 text-xs">æœ€çµ‚è³‡é‡‘</div>
                <div class="text-2xl font-bold {% if result.final_capital > capital %}text-green-600{% else %}text-red-600{% endif %}">
                    ${{ "{:,.0f}".format(result.final_capital) }}
                </div>
            </div>
            <div class="bg-white rounded-lg shadow p-4">
                <div class="text-gray-500 text-xs">ç²åˆ©é‡‘é¡</div>
                <div class="text-2xl font-bold {% if result.final_capital > capital %}text-green-600{% else %}text-red-600{% endif %}">
                    ${{ "{:+,.0f}".format(result.final_capital - capital) }}
                </div>
            </div>
        </div>

        <!-- åœ–è¡¨å€åŸŸ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- è³‡é‡‘æ›²ç·š -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="font-bold text-lg mb-4">ğŸ’° è³‡é‡‘æ›²ç·š</h3>
                <canvas id="equityChart" height="200"></canvas>
            </div>

            <!-- å›æ’¤æ›²ç·š -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="font-bold text-lg mb-4">ğŸ“‰ å›æ’¤æ›²ç·š</h3>
                <canvas id="drawdownChart" height="200"></canvas>
            </div>
        </div>

        <!-- ç­–ç•¥åƒæ•¸ -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h3 class="font-bold text-lg mb-4">âš™ï¸ ä½¿ç”¨çš„ç­–ç•¥åƒæ•¸</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                <div>MACD: {{ result.params.macd.fast }}, {{ result.params.macd.slow }}, {{ result.params.macd.signal }}</div>
                <div>RSI: {{ result.params.rsi.period }} ({{ result.params.rsi.oversold }}/{{ result.params.rsi.overbought }})</div>
                <div>ADX: {{ result.params.adx.period }} (> {{ result.params.adx.threshold }})</div>
                <div>ATR: {{ result.params.atr.period }}</div>
                <div>ç¢ºèªæ£’æ•¸: {{ result.params.confirm_bars }}</div>
                <div>åœæå€æ•¸: {{ result.params.stop_loss_multiplier }}</div>
            </div>
        </div>

        <!-- äº¤æ˜“æ˜ç´° -->
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <div class="bg-gray-800 text-white px-6 py-4">
                <h2 class="text-lg font-bold">ğŸ“œ äº¤æ˜“æ˜ç´°</h2>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">#</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">è²·å…¥æ—¥æœŸ</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">è²·å…¥</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">è³£å‡º</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">æç›Š</th>
                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">çµæœ</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        {% for trade in result.trades %}
                        <tr class="{% if trade.win %}bg-green-50{% else %}bg-red-50{% endif %}">
                            <td class="px-4 py-3 text-sm">{{ trade.id }}</td>
                            <td class="px-4 py-3 text-sm">{{ trade.entry_date }}</td>
                            <td class="px-4 py-3 text-sm text-right">${{ trade.entry_price }}</td>
                            <td class="px-4 py-3 text-sm text-right">${{ trade.exit_price }}</td>
                            <td class="px-4 py-3 text-sm text-right font-bold {% if trade.pnl >= 0 %}text-green-600{% else %}text-red-600{% endif %}">
                                {{ "%.2f"|format(trade.pnl) }}%
                            </td>
                            <td class="px-4 py-3 text-center">
                                {% if trade.win %}
                                <span class="px-2 py-1 bg-green-200 text-green-800 rounded text-xs">ç²åˆ©</span>
                                {% else %}
                                <span class="px-2 py-1 bg-red-200 text-red-800 rounded text-xs">è™§æ</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        {% endif %}

        <!-- è¿”å›é€£çµ -->
        <div class="mt-8 text-center">
            <a href="/backtest" class="text-blue-600 hover:underline">â† é‡æ–°å›æ¸¬</a>
        </div>
    </div>

    <!-- Chart.js åœ–è¡¨ -->
    {% if result and result.equity_curve %}
    <script>
        const equityData = {{ result.equity_curve | tojson }};
        const drawdownData = {{ result.drawdown | tojson }};
        
        // è³‡é‡‘æ›²ç·š
        new Chart(document.getElementById('equityChart'), {
            type: 'line',
            data: {
                labels: equityData.map(d => d.time),
                datasets: [{
                    label: 'è³‡é‡‘',
                    data: equityData.map(d => d.equity),
                    borderColor: '#2563eb',
                    backgroundColor: 'rgba(37, 99, 235, 0.1)',
                    fill: true,
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: { position: 'right' }
                }
            }
        });
        
        // å›æ’¤æ›²ç·š
        new Chart(document.getElementById('drawdownChart'), {
            type: 'line',
            data: {
                labels: drawdownData.map(d => d.time),
                datasets: [{
                    label: 'å›æ’¤',
                    data: drawdownData.map(d => d.drawdown),
                    borderColor: '#dc2626',
                    backgroundColor: 'rgba(220, 38, 38, 0.1)',
                    fill: true,
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: { 
                        position: 'right',
                        max: 0
                    }
                }
            }
        });
    </script>
    {% endif %}
</body>
</html>
